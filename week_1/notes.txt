docker run -it \
    -e POSTGRES_USER="root" \
    -e POSTGRES_PASSWORD="root" \
    -e POSTGRES_DB="ny_taxi" \
    -v $(pwd)/ny_taxi_postgres_data:/var/lib/postgresql/data \
    -p 5432:5432 \
postgres:13

docker pull dpage/pgadmin4

docker run -it \
    -e PGADMIN_DEFAULT_EMAIL="admin@admin.com" \
    -e PGADMIN_DEFAULT_PASSWORD="root" \
    -p 8080:80 \
dpage/pgadmin4

pgcli -h localhost -p5432 -u root -d ny_taxi

##network
docker network create pg-network 

docker run -it \
    -e POSTGRES_USER="root" \
    -e POSTGRES_PASSWORD="root" \
    -e POSTGRES_DB="ny_taxi" \
    -v $(pwd)/ny_taxi_postgres_data:/var/lib/postgresql/data \
    -p 5432:5432 \
    --network=pg-network \
    --name pg-database \
postgres:13

docker run -it \
    -e PGADMIN_DEFAULT_EMAIL="admin@admin.com" \
    -e PGADMIN_DEFAULT_PASSWORD="root" \
    -p 8080:80 \
    --network=pg-network \
    --name pgadmin \
dpage/pgadmin4

URL="https://github.com/DataTalksClub/nyc-tlc-data/releases/download/green/green_tripdata_2019-09.csv.gz"  

python3 ingest_data.py \
    --user=root \
    --password=root \
    --host=localhost \
    --port=5432 \ 
    --db=ny_taxi \
    --table_name=green_taxi_data \
    --url=https://github.com/DataTalksClub/nyc-tlc-data/releases/download/green/green_tripdata_2019-09.csv.gz

docker build -t taxi_ingest:v01 .

docker run -it \ 
  --network=pg-network \
  taxi_ingest:v01 \
  --user=root \
  --password=root \
  --host=localhost \
  --port=5432 \ 
  --db=ny_taxi \
  --table_name=green_taxi_data \
  --url=https://github.com/DataTalksClub/nyc-tlc-data/releases/download/green/green_tripdata_2019-09.csv.gz

de-zoomcamp-412619

europe-west1-b
EUROPE-WEST1

google_bigquery_dataset.ny_taxi_dataset: Creating...
google_storage_bucket.data-lake-bucket: Creating...
google_storage_bucket.data-lake-bucket: Creation complete after 1s [id=de-zoomcamp-412619-ny_txi_data]
google_bigquery_dataset.ny_taxi_dataset: Creation complete after 1s [id=projects/de-zoomcamp-412619/datasets/ny_taxi]

Apply complete! Resources: 2 added, 0 changed, 0 destroyed.

HW
1. docker run --rm: to automatically remove the container when it exits
2. The version of the package wheel is 0.42.0
3. The green taxi trips totally made on September 18th 2019 is 15612
4. 2019-09-26
5. "Brooklyn" "Manhattan" "Queens"
6. JFK Airport


select z1."Zone", z2."Zone", MAX(green_taxi_data."tip_amount") from green_taxi_data left join zones z1 ON green_taxi_data."PULocationID" = z1."LocationID"  left join zones z2 ON green_taxi_data."DOLocationID" = z2."LocationID" where DATE_TRUNC('month', lpep_pickup_datetime)= '2019-09-01 00:00:00' and z1."Zone" = 'Astoria' group by 1,2 order by 3 desc limit 5